# ADR-003: OpenAI Responses API (nao ChatCompletions)

**Status**: Aceito
**Data**: 2025-12-03
**Decisores**: Stakeholder

## Contexto

A OpenAI oferece duas APIs principais para interacao com modelos:
1. **ChatCompletions API** - API legada, amplamente usada
2. **Responses API** - API nova, recomendada pela OpenAI

O stakeholder definiu como **MANDATORIO** usar a Responses API.

## Decisao

**USAR EXCLUSIVAMENTE a OpenAI Responses API.**

**NUNCA usar ChatCompletions API.**

Esta e uma restricao de projeto, nao negociavel.

### Endpoints

```
# CORRETO - Responses API
POST https://api.openai.com/v1/responses

# PROIBIDO - ChatCompletions
POST https://api.openai.com/v1/chat/completions  # NAO USAR
```

### Estrutura de Request (Responses API)

```python
{
    "model": "gpt-4",
    "input": [
        {"role": "user", "content": "Hello"}
    ],
    "stream": True  # para streaming
}
```

### Beneficios da Responses API

- API mais recente e recomendada
- Melhor suporte a streaming
- Funcionalidades avancadas
- Melhor tratamento de erros
- Maior flexibilidade

## Alternativas Consideradas

### 1. ChatCompletions API
- **Pros**: Mais documentacao disponivel, mais exemplos
- **Contras**: API legada, sera depreciada, **PROIBIDA pelo stakeholder**

### 2. Responses API (ESCOLHIDA - MANDATORIO)
- **Pros**: API moderna, recomendada, melhor suporte
- **Contras**: Menos exemplos disponiveis (API mais nova)

## Consequencias

### Positivas
- Alinhamento com direcao futura da OpenAI
- Melhor suporte a funcionalidades avancadas
- Codigo preparado para o futuro

### Negativas
- Menos exemplos na comunidade (API mais nova)
- Documentacao pode ser menos abundante

## Restricoes de Implementacao

1. **NUNCA** importar ou usar `openai.ChatCompletion`
2. **NUNCA** fazer requests para `/v1/chat/completions`
3. **SEMPRE** usar endpoint `/v1/responses`
4. Code review deve rejeitar qualquer uso de ChatCompletions

## Validacao

- [ ] OpenAIProvider usa APENAS Responses API
- [ ] Nenhuma referencia a ChatCompletions no codigo
- [ ] Testes verificam uso correto da API
- [ ] Lint/CI falha se ChatCompletions for detectado

## Referencias

- OpenAI Responses API Documentation
- Requisito mandatorio do stakeholder
