# ADR-005: Monorepo com src layout

**Status**: Aceito
**Data**: 2025-12-03
**Decisores**: Stakeholder

## Contexto

Precisamos definir a estrutura de diretorios do projeto ForgeLLMClient.
Opcoes principais:
- Flat layout (pacote na raiz)
- src layout (pacote dentro de src/)
- Multi-repo (repositorios separados)

## Decisao

Usar **Monorepo com src layout**.

### Estrutura

```mermaid
flowchart TB
    subgraph forgeLLMClient["forgeLLMClient/"]
        subgraph src["src/"]
            subgraph forge_llm["forge_llm/"]
                client["client.py"]
                subgraph domain["domain/"]
                    entities["entities.py"]
                    vos["value_objects.py"]
                    exc["exceptions.py"]
                end
                subgraph application["application/"]
                    ports["ports/"]
                    usecases["usecases/"]
                    dtos["dtos/"]
                end
                subgraph infra["infrastructure/"]
                    config["config.py"]
                    http["http_client.py"]
                end
                subgraph providers["providers/"]
                    openai["openai_provider.py"]
                    anthropic["anthropic_provider.py"]
                    mock["mock_provider.py"]
                end
            end
        end
        subgraph tests["tests/"]
            unit["unit/"]
            integration["integration/"]
            bdd["bdd/"]
        end
        subgraph specs["specs/"]
            bdd_specs["bdd/"]
            roadmap["roadmap/"]
        end
        pyproject["pyproject.toml"]
    end

    style domain fill:#e8f5e9
    style application fill:#fff3e0
    style infra fill:#e3f2fd
    style providers fill:#f3e5f5
```

### Nome do Pacote

- **Diretorio**: `forge_llm` (underscore)
- **PyPI**: `forge-llm` (hifen)

## Alternativas Consideradas

### 1. Flat layout

```mermaid
flowchart TB
    subgraph flat["forgeLLMClient/"]
        forge_llm["forge_llm/"]
        tests["tests/"]
        pyproject["pyproject.toml"]
    end
```

- **Pros**: Mais simples
- **Contras**: Pode causar conflitos de import durante desenvolvimento

### 2. Multi-repo
- **Pros**: Versionamento independente
- **Contras**: Overhead de manutencao, sincronizacao complexa

### 3. src layout (ESCOLHIDA)
- **Pros**: Padrao moderno, evita conflitos, facil publicar
- **Contras**: Ligeiramente mais verboso

## Consequencias

### Positivas
- Imports sempre funcionam corretamente
- Facil publicar no PyPI
- Testes rodam contra pacote instalado, nao fonte
- Alinhado com recomendacoes modernas Python

### Negativas
- Um nivel extra de diretorio
- Precisa instalar pacote para rodar (`pip install -e .`)

## Configuracao pyproject.toml

```toml
[project]
name = "forge-llm"
version = "0.1.0"

[tool.setuptools.packages.find]
where = ["src"]
```

## Validacao

- [ ] `pip install -e .` funciona
- [ ] Imports funcionam: `from forge_llm import Client`
- [ ] Testes rodam corretamente
- [ ] Build gera pacote correto

## Referencias

- https://packaging.python.org/en/latest/discussions/src-layout-vs-flat-layout/
- PEP 621
